<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartLearn - Messages</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="../styles.css" />
    <style>
      .messages-page { padding: 0 0 2rem; }
      .messages-layout { display: flex; height: calc(100vh - 80px); }
      .threads-sidebar { width: 320px; background: white; border-right: 1px solid var(--light-gray); display: flex; flex-direction: column; }
      .dark-mode .threads-sidebar { background-color: var(--light-gray); border-right-color: #475569; }
      .threads-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid var(--light-gray); }
      .threads-search { padding: 0.6rem 0.8rem; border: 2px solid var(--light-gray); border-radius: 8px; width: 100%; }
      .thread-list { overflow-y: auto; }
      .thread-item { display: flex; gap: 0.8rem; align-items: center; padding: 0.9rem 1rem; cursor: pointer; transition: var(--transition); border-bottom: 1px solid var(--light-gray); }
      .thread-item:hover { background: #f8fafc; }
      .dark-mode .thread-item:hover { background-color: #334155; }
      .avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; }
      .thread-meta { flex: 1; }
      .thread-name { font-weight: 600; color: var(--dark); }
      .dark-mode .thread-name { color: var(--light); }
      .thread-preview { color: var(--gray); font-size: 0.9rem; }
      .unread-badge { background: var(--danger); color: white; border-radius: 12px; font-size: 0.75rem; padding: 0.2rem 0.5rem; }
      .chat-window { flex: 1; background: var(--light-gray); display: flex; flex-direction: column; }
      .dark-mode .chat-window { background-color: #2d3748; }
      .chat-header { background: white; padding: 1rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--light-gray); }
      .dark-mode .chat-header { background-color: var(--light-gray); border-bottom-color: #475569; }
      .chat-title { display: flex; align-items: center; gap: 0.8rem; }
      .chat-title-status { color: var(--gray); font-size: 0.9rem; }
      .chat-controls { display: flex; gap: 0.6rem; }
      .threads-toggle { display: none; background: none; border: 2px solid var(--primary); color: var(--primary); border-radius: 8px; padding: 0.4rem 0.6rem; }
      .chat-messages { flex: 1; padding: 1.2rem; overflow-y: auto; display: flex; flex-direction: column; gap: 0.8rem; }
      .message-group { display: flex; flex-direction: column; gap: 0.4rem; }
      .date-separator { align-self: center; background: rgba(0,0,0,0.06); color: var(--gray); font-size: 0.8rem; padding: 0.25rem 0.6rem; border-radius: 10px; }
      .message-row { display: flex; }
      .message-bubble { max-width: 70%; padding: 0.8rem 1rem; border-radius: 14px; position: relative; box-shadow: var(--box-shadow); }
      .message-bubble.user { align-self: flex-end; margin-left: auto; background: var(--primary); color: white; border-bottom-right-radius: 5px; }
      .message-bubble.other { align-self: flex-start; background: white; color: var(--dark); border-bottom-left-radius: 5px; }
      .dark-mode .message-bubble.other { background-color: var(--light-gray); color: var(--light); }
      .timestamp { font-size: 0.75rem; color: var(--gray); margin-top: 0.25rem; text-align: right; }
      .chat-input { background: white; border-top: 1px solid var(--light-gray); padding: 0.8rem; display: flex; align-items: center; gap: 0.6rem; }
      .dark-mode .chat-input { background-color: var(--light-gray); border-top-color: #475569; }
      .chat-input input[type="text"] { flex: 1; padding: 0.8rem; border: 2px solid var(--light-gray); border-radius: 20px; }
      .attach-btn { background: none; border: 2px solid var(--primary); color: var(--primary); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
      .send-btn { background: var(--primary); color: white; border: none; border-radius: 20px; padding: 0.7rem 1.2rem; font-weight: 600; }
      @media (max-width: 992px) { .threads-sidebar { width: 280px; } }
      @media (max-width: 768px) {
        .messages-layout { flex-direction: column; }
        .threads-sidebar { position: fixed; top: 60px; left: 0; bottom: 0; width: 85%; max-width: 320px; transform: translateX(-100%); transition: var(--transition); z-index: 1001; }
        .threads-toggle { display: inline-block; }
        .threads-open .threads-sidebar { transform: translateX(0); }
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="../home.html" class="logo">
        <i class="fas fa-brain"></i>
        <span>SmartLearn</span>
      </a>
      <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
      <div class="nav-links">
        <a href="../home.html" class="nav-link" data-page="home">Home</a>
        <a href="../courses.html" class="nav-link" data-page="courses">Courses</a>
        <a href="student.html" class="nav-link" data-page="student">Students</a>
        <a href="../chatbot.html" class="nav-link" data-page="chatbot">Chatbot</a>
        <a href="../about.html" class="nav-link" data-page="about">About</a>
        <a href="../contact.html" class="nav-link" data-page="contact">Contact</a>
      </div>
      <div class="nav-icons">
        <div class="role-indicator">
          <i class="fas fa-user-graduate"></i>
          <span>Student</span>
        </div>
        <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
        <button class="chatbot-toggle" id="chatbotToggle"><i class="fas fa-comment-alt"></i></button>
      </div>
    </nav>

    <section class="messages-page">
      <div class="messages-layout">
        <aside class="threads-sidebar">
          <div class="threads-header">
            <strong>Threads</strong>
          </div>
          <div style="padding:0.8rem 1rem"><input id="threadsSearch" class="threads-search" placeholder="Search messages" /></div>
          <div id="threadList" class="thread-list"></div>
        </aside>
        <div class="chat-window">
          <div class="chat-header">
            <div class="chat-title">
              <button class="threads-toggle" id="threadsToggle"><i class="fas fa-bars"></i></button>
              <div class="avatar" id="chatAvatar">L</div>
              <div>
                <div id="chatName" style="font-weight:700">Lecturer</div>
                <div class="chat-title-status" id="chatStatus">Online</div>
              </div>
            </div>
            <div class="chat-controls">
              <button class="btn">New Message</button>
            </div>
          </div>
          <div id="messagesContainer" class="chat-messages"></div>
          <div class="chat-input">
            <button id="attachBtn" class="attach-btn"><i class="fas fa-paperclip"></i></button>
            <input type="file" id="attachmentInput" style="display:none" />
            <input type="text" id="messageInput" placeholder="Type a message" />
            <button id="messageSendBtn" class="send-btn">Send</button>
          </div>
        </div>
      </div>
    </section>

    <div class="chatbot-toggle-btn" id="floatingChatBtn"><i class="fas fa-comment"></i></div>

    <footer>
      <div class="footer-content">
        <div class="footer-logo"><i class="fas fa-brain"></i> SmartLearn</div>
        <p>Empowering learners with AI-driven education</p>
        <div class="footer-links">
          <a href="../home.html">Home</a>
          <a href="../courses.html">Courses</a>
          <a href="student.html">Students</a>
          <a href="../chatbot.html">Chatbot</a>
          <a href="../about.html">About</a>
          <a href="../contact.html">Contact</a>
        </div>
        <div class="copyright">&copy; 2025 SmartLearn. All rights reserved.</div>
      </div>
    </footer>

    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const tl = document.getElementById('threadList')
        const mc = document.getElementById('messagesContainer')
        const mi = document.getElementById('messageInput')
        const sb = document.getElementById('messageSendBtn')
        const attachBtn = document.getElementById('attachBtn')
        const attachmentInput = document.getElementById('attachmentInput')
        const cn = document.getElementById('chatName')
        const ca = document.getElementById('chatAvatar')
        function loadMessages(){ try{ const r = localStorage.getItem('messagesStore'); return r?JSON.parse(r):[] }catch(e){ return [] } }
        function saveMessages(list){ try{ localStorage.setItem('messagesStore', JSON.stringify(list)) }catch(e){} }
        let threads = []
        function build(){
          const list = loadMessages()
          const map = {}
          list.forEach(m => { const key = m.target; if(!map[key]) map[key] = []; map[key].push(m) })
          threads = Object.keys(map).map(k => ({ key:k, name:k, initial:k.includes('course:')?k.split(':')[1][0].toUpperCase():'L', messages: map[k] }))
        }
        function renderThreads(){
          tl.innerHTML = ''
          threads.forEach((t,i) => {
            const item = document.createElement('div')
            item.className = 'thread-item'
            const avatar = document.createElement('div')
            avatar.className = 'avatar'; avatar.textContent = t.initial
            const meta = document.createElement('div')
            meta.className = 'thread-meta'
            const name = document.createElement('div')
            name.className = 'thread-name'; name.textContent = t.name
            meta.appendChild(name)
            item.appendChild(avatar)
            item.appendChild(meta)
            item.addEventListener('click', () => select(i))
            tl.appendChild(item)
          })
        }
        function renderMessages(thread){
          mc.innerHTML = ''
          thread.messages.forEach(m => {
            const group = document.createElement('div')
            group.className = 'message-group'
            const row = document.createElement('div')
            row.className = 'message-row'
            const bubble = document.createElement('div')
            bubble.className = 'message-bubble ' + (m.from==='student'?'user':'other')
            bubble.textContent = m.text
            const ts = document.createElement('div')
            ts.className = 'timestamp'
            ts.textContent = new Date(m.ts).toLocaleTimeString()
            row.appendChild(bubble)
            group.appendChild(row)
            group.appendChild(ts)
            mc.appendChild(group)
          })
          mc.scrollTop = mc.scrollHeight
        }
        let active = 0
        function select(i){ active = i; const t = threads[i]; cn.textContent = t.name; ca.textContent = t.initial; renderMessages(t) }
        sb.addEventListener('click', () => {
          const text = mi.value.trim(); if(!text) return
          const t = threads[active]
          const list = loadMessages(); list.push({ id: Date.now(), from:'student', target:t.key, text, ts:new Date().toISOString() }); saveMessages(list)
          mi.value=''
          build(); select(active)
        })
        attachBtn.addEventListener('click', () => { attachmentInput.click() })
        attachmentInput.addEventListener('change', () => {
          const file = attachmentInput.files[0]; if(!file) return
          const t = threads[active]
          const list = loadMessages(); list.push({ id: Date.now(), from:'student', target:t.key, text:'Attachment: '+file.name, ts:new Date().toISOString() }); saveMessages(list)
          attachmentInput.value=''; build(); select(active)
        })
        build(); renderThreads(); if(threads.length) select(0)
      })
    </script>
    <script>
      (function(){
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
          themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = themeToggle.querySelector('i');
            if (icon) {
              if (document.body.classList.contains('dark-mode')) {
                icon.classList.replace('fa-moon','fa-sun');
              } else {
                icon.classList.replace('fa-sun','fa-moon');
              }
            }
          });
        }
        function mountChatbotOverlay(){
          if (document.getElementById('chatbotContainer')) return;
          const wrap = document.createElement('div');
          wrap.className = 'chatbot-container';
          wrap.id = 'chatbotContainer';
          wrap.style.display = 'flex';
          wrap.innerHTML = '<div class="chatbot-header"><h3><i class="fas fa-robot"></i> SmartLearn AI Tutor</h3><button class="close-chat" id="closeChat">&times;</button></div><div class="chat-messages" id="chatMessages"><div class="message bot-message">Hello! I\'m your SmartLearn Assistant. What topic would you like help with?</div></div><div class="chat-input"><input type="text" id="userInput" placeholder="Type your message..." /><button id="sendBtn">Send</button></div>';
          document.body.appendChild(wrap);
          const sendEl = document.getElementById('sendBtn');
          const inputEl = document.getElementById('userInput');
          const closeEl = document.getElementById('closeChat');
          function addMessage(message, isUser){ const box = document.getElementById('chatMessages'); if (!box) return; const div = document.createElement('div'); div.className = 'message ' + (isUser ? 'user-message' : 'bot-message'); div.textContent = message; box.appendChild(div); box.scrollTop = box.scrollHeight; }
          function getBotResponse(msg){ const m = msg.toLowerCase(); const map = { hello:"Hi there! How can I help you learn today?", hi:"Hello! What would you like to learn about?", programming:"Programming is a valuable skill!", default:"I\'m still learning! Try asking about programming or quizzes." }; for(const k in map){ if(m.includes(k)) return map[k]; } return map.default; }
          function handleUserMessage(){ const inputEl = document.getElementById('userInput'); if (!inputEl) return; const message = inputEl.value.trim(); if (!message) return; addMessage(message, true); inputEl.value=''; setTimeout(()=>{ addMessage(getBotResponse(message)); }, 500); }
          if (sendEl) sendEl.addEventListener('click', handleUserMessage);
          if (inputEl) inputEl.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserMessage(); });
          if (closeEl) closeEl.addEventListener('click', () => { const c = document.getElementById('chatbotContainer'); if (c) c.style.display = 'none'; });
        }
        function toggleChatbot(){ let c = document.getElementById('chatbotContainer'); if(!c){ mountChatbotOverlay(); c = document.getElementById('chatbotContainer'); } if(!c) return; c.style.display = c.style.display==='flex'?'none':'flex'; }
        const sBtn = document.getElementById('chatbotToggle');
        const fBtn = document.getElementById('floatingChatBtn');
        if (sBtn) sBtn.addEventListener('click', toggleChatbot);
        if (fBtn) fBtn.addEventListener('click', toggleChatbot);
      })();
    </script>
  </body>
</html>
